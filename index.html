<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Building Java 9 Modules</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link crossorigin href="//assets.gradle.com" rel="preconnect">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,400i">
<link rel="stylesheet" href="https://guides.gradle.org/css/asciidoctor.css">
<link rel="stylesheet" href="https://guides.gradle.org/css/docs-blue-theme-4.8.css">
<link rel="apple-touch-icon" sizes="180x180" href="https://guides.gradle.org/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://guides.gradle.org/icon/manifest.json">
<link rel="shortcut icon" href="https://guides.gradle.org/icon/favicon.ico">
<script defer src="https://guides.gradle.org/js/guides-4.8.js"></script>
<script defer src="https://guides.gradle.org/js/set-time-to-complete-text.js"></script>
<script async src="https://guides.gradle.org/js/autotrack.js"></script>

</head>
<body class="article">
<header class="site-layout__header site-header" itemscope="itemscope" itemtype="https://schema.org/WPHeader">
    <nav class="site-header__navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
        <div class="site-header__navigation-header">
            <a target="_top" class="logo" href="https://guides.gradle.org" title="Gradle Docs"><svg width="179px" height="36px" viewBox="0 0 214 43" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M46.8764467,7.88772959 C45.3200364,5.08928963 42.538267,4.25293158 40.5730047,4.21328173 C38.1617855,4.16464717 36.1814618,5.49994885 36.5560017,6.37654271 C36.6363956,6.56473304 37.0884369,7.5470924 37.3659256,7.95257566 C37.767596,8.5393154 38.4866528,8.08851802 38.7385072,7.95462652 C39.4905793,7.55490518 40.2943191,7.42550602 41.2059822,7.53175982 C42.0774483,7.63332596 43.2351806,8.17045455 44.0118896,9.6627931 C45.8397043,13.1750281 40.1972679,20.4036071 33.1344723,15.3978616 C26.0715771,10.3921161 19.203283,12.0507692 16.0936541,13.059692 C12.9841249,14.0684195 11.5547888,15.0829089 12.7835391,17.4289889 C14.4533587,20.6171889 13.8998775,19.6389313 15.519027,22.2780882 C18.0908346,26.4697421 23.7203042,20.3491129 23.7203042,20.3491129 C19.526654,26.5308771 15.931769,25.0372689 14.5529036,22.8762541 C13.3102888,20.9285282 12.3447638,18.6830377 12.3447638,18.6830377 C1.72319071,22.4290701 4.5969243,38.9663805 4.5969243,38.9663805 L9.87170315,38.9663805 C11.2165558,32.8772955 16.0248305,33.1018153 16.848918,38.9663805 L20.8738008,38.9663805 C24.4333764,27.0763067 33.4552501,38.9663805 33.4552501,38.9663805 L38.701901,38.9663805 C37.2324677,30.8555435 41.6532357,28.3073078 44.4391943,23.5530361 C47.2254521,18.7983738 49.8646868,12.9818572 46.8764467,7.88772959 L46.8764467,7.88772959 Z M33.3433369,23.5472742 C30.5694474,22.6419684 31.5616042,19.8816157 31.5616042,19.8816157 C31.5616042,19.8816157 33.9840944,20.6649445 37.2609946,21.7341234 C37.0723781,22.5903064 35.4423564,24.232455 33.3433369,23.5472742 L33.3433369,23.5472742 Z" id="Fill-9" fill="#02303A"></path><path d="M35.8042288,21.4659498 C35.8871163,22.2300396 35.3025149,22.9172712 34.4983762,23.0008679 C33.6942375,23.0844647 32.9752804,22.5327848 32.8923929,21.7685973 C32.8095053,21.0045075 33.3942065,20.3172758 34.1982455,20.2336791 C35.0023842,20.1500824 35.721441,20.7017623 35.8042288,21.4659498" id="Fill-10" fill="#00303A"></path><path d="M72.236,22.3 L72.236,29.32 C71.3559956,29.9680032 70.418005,30.4419985 69.422,30.742 C68.425995,31.0420015 67.3600057,31.192 66.224,31.192 C64.8079929,31.192 63.5260057,30.9720022 62.378,30.532 C61.2299943,30.0919978 60.2500041,29.4800039 59.438,28.696 C58.6259959,27.9119961 58.0000022,26.9760054 57.56,25.888 C57.1199978,24.7999946 56.9,23.6120064 56.9,22.324 C56.9,21.0199935 57.1119979,19.8240054 57.536,18.736 C57.9600021,17.6479946 58.5619961,16.7120039 59.342,15.928 C60.1220039,15.1439961 61.0679944,14.5360022 62.18,14.104 C63.2920056,13.6719978 64.5399931,13.456 65.924,13.456 C66.6280035,13.456 67.2859969,13.5119994 67.898,13.624 C68.5100031,13.7360006 69.0779974,13.889999 69.602,14.086 C70.1260026,14.282001 70.6039978,14.5199986 71.036,14.8 C71.4680022,15.0800014 71.8639982,15.3879983 72.224,15.724 L71.3,17.188 C71.1559993,17.4200012 70.9680012,17.5619997 70.736,17.614 C70.5039988,17.6660003 70.2520014,17.6080008 69.98,17.44 L69.188,16.984 C68.9239987,16.8319992 68.6300016,16.7000006 68.306,16.588 C67.9819984,16.4759994 67.618002,16.3840004 67.214,16.312 C66.809998,16.2399996 66.3440026,16.204 65.816,16.204 C64.9599957,16.204 64.1860035,16.3479986 63.494,16.636 C62.8019965,16.9240014 62.2120024,17.3359973 61.724,17.872 C61.2359976,18.4080027 60.8600013,19.0519962 60.596,19.804 C60.3319987,20.5560038 60.2,21.3959954 60.2,22.324 C60.2,23.316005 60.3419986,24.2019961 60.626,24.982 C60.9100014,25.7620039 61.3099974,26.4219973 61.826,26.962 C62.3420026,27.5020027 62.9639964,27.9139986 63.692,28.198 C64.4200036,28.4820014 65.2319955,28.624 66.128,28.624 C66.7680032,28.624 67.3399975,28.5560007 67.844,28.42 C68.3480025,28.2839993 68.8399976,28.1000012 69.32,27.868 L69.32,24.724 L67.136,24.724 C66.927999,24.724 66.7660006,24.6660006 66.65,24.55 C66.5339994,24.4339994 66.476,24.2920008 66.476,24.124 L66.476,22.3 L72.236,22.3 Z M77.504,20.824 C77.8880019,20.0879963 78.3439974,19.5100021 78.872,19.09 C79.4000026,18.6699979 80.0239964,18.46 80.744,18.46 C81.3120028,18.46 81.7679983,18.5839988 82.112,18.832 L81.92,21.052 C81.8799998,21.1960007 81.8220004,21.2979997 81.746,21.358 C81.6699996,21.4180003 81.5680006,21.448 81.44,21.448 C81.3199994,21.448 81.1420012,21.4280002 80.906,21.388 C80.6699988,21.3479998 80.4400011,21.328 80.216,21.328 C79.8879984,21.328 79.5960013,21.3759995 79.34,21.472 C79.0839987,21.5680005 78.854001,21.7059991 78.65,21.886 C78.445999,22.0660009 78.2660008,22.2839987 78.11,22.54 C77.9539992,22.7960013 77.8080007,23.0879984 77.672,23.416 L77.672,31 L74.708,31 L74.708,18.688 L76.448,18.688 C76.7520015,18.688 76.9639994,18.7419995 77.084,18.85 C77.2040006,18.9580005 77.2839998,19.1519986 77.324,19.432 L77.504,20.824 Z M90.008,25.744 C89.1519957,25.7840002 88.4320029,25.8579995 87.848,25.966 C87.2639971,26.0740005 86.7960018,26.2119992 86.444,26.38 C86.0919982,26.5480008 85.8400008,26.7439989 85.688,26.968 C85.5359992,27.1920011 85.46,27.4359987 85.46,27.7 C85.46,28.2200026 85.6139985,28.5919989 85.922,28.816 C86.2300015,29.0400011 86.6319975,29.152 87.128,29.152 C87.736003,29.152 88.2619978,29.0420011 88.706,28.822 C89.1500022,28.6019989 89.5839979,28.2680022 90.008,27.82 L90.008,25.744 Z M83.216,20.404 C84.6320071,19.1079935 86.33599,18.46 88.328,18.46 C89.0480036,18.46 89.6919972,18.5779988 90.26,18.814 C90.8280028,19.0500012 91.307998,19.3779979 91.7,19.798 C92.092002,20.2180021 92.389999,20.7199971 92.594,21.304 C92.798001,21.8880029 92.9,22.5279965 92.9,23.224 L92.9,31 L91.556,31 C91.2759986,31 91.0600008,30.9580004 90.908,30.874 C90.7559992,30.7899996 90.6360004,30.6200013 90.548,30.364 L90.284,29.476 C89.9719984,29.7560014 89.6680015,30.0019989 89.372,30.214 C89.0759985,30.4260011 88.7680016,30.6039993 88.448,30.748 C88.1279984,30.8920007 87.7860018,31.0019996 87.422,31.078 C87.0579982,31.1540004 86.6560022,31.192 86.216,31.192 C85.6959974,31.192 85.2160022,31.1220007 84.776,30.982 C84.3359978,30.8419993 83.9560016,30.6320014 83.636,30.352 C83.3159984,30.0719986 83.0680009,29.7240021 82.892,29.308 C82.7159991,28.8919979 82.628,28.4080028 82.628,27.856 C82.628,27.5439984 82.6799995,27.2340015 82.784,26.926 C82.8880005,26.6179985 83.0579988,26.3240014 83.294,26.044 C83.5300012,25.7639986 83.8359981,25.5000012 84.212,25.252 C84.5880019,25.0039988 85.0499973,24.7880009 85.598,24.604 C86.1460027,24.4199991 86.7839964,24.2700006 87.512,24.154 C88.2400036,24.0379994 89.0719953,23.9680001 90.008,23.944 L90.008,23.224 C90.008,22.3999959 89.8320018,21.790002 89.48,21.394 C89.1279982,20.997998 88.6200033,20.8 87.956,20.8 C87.4759976,20.8 87.0780016,20.8559994 86.762,20.968 C86.4459984,21.0800006 86.1680012,21.2059993 85.928,21.346 C85.6879988,21.4860007 85.470001,21.6119994 85.274,21.724 C85.077999,21.8360006 84.8600012,21.892 84.62,21.892 C84.411999,21.892 84.2360007,21.8380005 84.092,21.73 C83.9479993,21.6219995 83.8320004,21.4960007 83.744,21.352 L83.216,20.404 Z M103.412,21.832 C103.075998,21.423998 102.710002,21.1360008 102.314,20.968 C101.917998,20.7999992 101.492002,20.716 101.036,20.716 C100.587998,20.716 100.184002,20.7999992 99.824,20.968 C99.4639982,21.1360008 99.1560013,21.3899983 98.9,21.73 C98.6439987,22.0700017 98.4480007,22.5019974 98.312,23.026 C98.1759993,23.5500026 98.108,24.1679964 98.108,24.88 C98.108,25.6000036 98.1659994,26.2099975 98.282,26.71 C98.3980006,27.2100025 98.5639989,27.6179984 98.78,27.934 C98.9960011,28.2500016 99.2599984,28.4779993 99.572,28.618 C99.8840016,28.7580007 100.231998,28.828 100.616,28.828 C101.232003,28.828 101.755998,28.7000013 102.188,28.444 C102.620002,28.1879987 103.027998,27.8240024 103.412,27.352 L103.412,21.832 Z M106.376,13.168 L106.376,31 L104.564,31 C104.171998,31 103.924001,30.8200018 103.82,30.46 L103.568,29.272 C103.071998,29.8400028 102.502003,30.2999982 101.858,30.652 C101.213997,31.0040018 100.464004,31.18 99.608,31.18 C98.9359966,31.18 98.3200028,31.0400014 97.76,30.76 C97.1999972,30.4799986 96.718002,30.0740027 96.314,29.542 C95.909998,29.0099973 95.5980011,28.3520039 95.378,27.568 C95.1579989,26.7839961 95.048,25.888005 95.048,24.88 C95.048,23.9679954 95.1719988,23.1200039 95.42,22.336 C95.6680012,21.5519961 96.0239977,20.8720029 96.488,20.296 C96.9520023,19.7199971 97.5079968,19.2700016 98.156,18.946 C98.8040032,18.6219984 99.531996,18.46 100.34,18.46 C101.028003,18.46 101.615998,18.5679989 102.104,18.784 C102.592002,19.0000011 103.027998,19.2919982 103.412,19.66 L103.412,13.168 L106.376,13.168 Z M112.304,13.168 L112.304,31 L109.34,31 L109.34,13.168 L112.304,13.168 Z M123.2,23.428 C123.2,23.0439981 123.146001,22.6820017 123.038,22.342 C122.929999,22.0019983 122.768001,21.7040013 122.552,21.448 C122.335999,21.1919987 122.062002,20.9900007 121.73,20.842 C121.397998,20.6939993 121.012002,20.62 120.572,20.62 C119.715996,20.62 119.042002,20.8639976 118.55,21.352 C118.057998,21.8400024 117.744001,22.5319955 117.608,23.428 L123.2,23.428 Z M117.548,25.216 C117.596,25.8480032 117.707999,26.3939977 117.884,26.854 C118.060001,27.3140023 118.291999,27.6939985 118.58,27.994 C118.868001,28.2940015 119.209998,28.5179993 119.606,28.666 C120.002002,28.8140007 120.439998,28.888 120.92,28.888 C121.400002,28.888 121.813998,28.8320006 122.162,28.72 C122.510002,28.6079994 122.813999,28.4840007 123.074,28.348 C123.334001,28.2119993 123.561999,28.0880006 123.758,27.976 C123.954001,27.8639994 124.143999,27.808 124.328,27.808 C124.576001,27.808 124.759999,27.8999991 124.88,28.084 L125.732,29.164 C125.403998,29.5480019 125.036002,29.8699987 124.628,30.13 C124.219998,30.3900013 123.794002,30.5979992 123.35,30.754 C122.905998,30.9100008 122.454002,31.0199997 121.994,31.084 C121.533998,31.1480003 121.088002,31.18 120.656,31.18 C119.799996,31.18 119.004004,31.0380014 118.268,30.754 C117.531996,30.4699986 116.892003,30.0500028 116.348,29.494 C115.803997,28.9379972 115.376002,28.2500041 115.064,27.43 C114.751998,26.6099959 114.596,25.6600054 114.596,24.58 C114.596,23.7399958 114.731999,22.9500037 115.004,22.21 C115.276001,21.4699963 115.665997,20.8260027 116.174,20.278 C116.682003,19.7299973 117.301996,19.2960016 118.034,18.976 C118.766004,18.6559984 119.591995,18.496 120.512,18.496 C121.288004,18.496 122.003997,18.6199988 122.66,18.868 C123.316003,19.1160012 123.879998,19.4779976 124.352,19.954 C124.824002,20.4300024 125.193999,21.0139965 125.462,21.706 C125.730001,22.3980035 125.864,23.1879956 125.864,24.076 C125.864,24.5240022 125.816,24.8259992 125.72,24.982 C125.624,25.1380008 125.440001,25.216 125.168,25.216 L117.548,25.216 Z M148.832,23.296 L148.832,29.332 C147.983996,29.932003 147.080005,30.3919984 146.12,30.712 C145.159995,31.0320016 144.080006,31.192 142.88,31.192 C141.535993,31.192 140.328005,30.9860021 139.256,30.574 C138.183995,30.1619979 137.270004,29.5780038 136.514,28.822 C135.757996,28.0659962 135.178002,27.1520054 134.774,26.08 C134.369998,25.0079946 134.168,23.8160066 134.168,22.504 C134.168,21.1919934 134.365998,20.0020053 134.762,18.934 C135.158002,17.8659947 135.725996,16.9540038 136.466,16.198 C137.206004,15.4419962 138.099995,14.8580021 139.148,14.446 C140.196005,14.0339979 141.375993,13.828 142.688,13.828 C143.336003,13.828 143.933997,13.8719996 144.482,13.96 C145.030003,14.0480004 145.539998,14.1779991 146.012,14.35 C146.484002,14.5220009 146.923998,14.7339987 147.332,14.986 C147.740002,15.2380013 148.131998,15.5279984 148.508,15.856 L148.172,16.384 C148.059999,16.576001 147.892001,16.6200005 147.668,16.516 C147.547999,16.4679998 147.376001,16.3560009 147.152,16.18 C146.927999,16.0039991 146.620002,15.820001 146.228,15.628 C145.835998,15.435999 145.350003,15.2640008 144.77,15.112 C144.189997,14.9599992 143.484004,14.884 142.652,14.884 C141.547994,14.884 140.550004,15.0599982 139.658,15.412 C138.765996,15.7640018 138.006003,16.2679967 137.378,16.924 C136.749997,17.5800033 136.266002,18.3799953 135.926,19.324 C135.585998,20.2680047 135.416,21.3279941 135.416,22.504 C135.416,23.696006 135.585998,24.7679952 135.926,25.72 C136.266002,26.6720048 136.757997,27.4799967 137.402,28.144 C138.046003,28.8080033 138.827995,29.3159982 139.748,29.668 C140.668005,30.0200018 141.703994,30.196 142.856,30.196 C143.360003,30.196 143.825998,30.1640003 144.254,30.1 C144.682002,30.0359997 145.089998,29.9460006 145.478,29.83 C145.866002,29.7139994 146.241998,29.5700009 146.606,29.398 C146.970002,29.2259991 147.339998,29.0320011 147.716,28.816 L147.716,24.244 L144.464,24.244 C144.376,24.244 144.302,24.2160003 144.242,24.16 C144.182,24.1039997 144.152,24.0400004 144.152,23.968 L144.152,23.296 L148.832,23.296 Z M161.408,19.06 L161.408,31 L160.772,31 C160.571999,31 160.456,30.896001 160.424,30.688 L160.316,28.912 C159.763997,29.6000034 159.126004,30.1519979 158.402,30.568 C157.677996,30.9840021 156.872004,31.192 155.984,31.192 C155.319997,31.192 154.740002,31.088001 154.244,30.88 C153.747998,30.671999 153.336002,30.372002 153.008,29.98 C152.679998,29.587998 152.432001,29.1160028 152.264,28.564 C152.095999,28.0119972 152.012,27.3880035 152.012,26.692 L152.012,19.06 L153.164,19.06 L153.164,26.692 C153.164,27.8120056 153.419997,28.6899968 153.932,29.326 C154.444003,29.9620032 155.223995,30.28 156.272,30.28 C157.048004,30.28 157.773997,30.082002 158.45,29.686 C159.126003,29.289998 159.727997,28.7400035 160.256,28.036 L160.256,19.06 L161.408,19.06 Z M166.604,19.06 L166.604,31 L165.464,31 L165.464,19.06 L166.604,19.06 Z M167.096,14.944 C167.096,15.0880007 167.066,15.2219994 167.006,15.346 C166.946,15.4700006 166.868,15.5799995 166.772,15.676 C166.676,15.7720005 166.564001,15.8479997 166.436,15.904 C166.307999,15.9600003 166.172001,15.988 166.028,15.988 C165.883999,15.988 165.748001,15.9600003 165.62,15.904 C165.491999,15.8479997 165.38,15.7720005 165.284,15.676 C165.188,15.5799995 165.112,15.4700006 165.056,15.346 C165,15.2219994 164.972,15.0880007 164.972,14.944 C164.972,14.7999993 165,14.6620007 165.056,14.53 C165.112,14.3979993 165.188,14.2840005 165.284,14.188 C165.38,14.0919995 165.491999,14.0160003 165.62,13.96 C165.748001,13.9039997 165.883999,13.876 166.028,13.876 C166.172001,13.876 166.307999,13.9039997 166.436,13.96 C166.564001,14.0160003 166.676,14.0919995 166.772,14.188 C166.868,14.2840005 166.946,14.3979993 167.006,14.53 C167.066,14.6620007 167.096,14.7999993 167.096,14.944 Z M178.82,21.628 C178.363998,20.9399966 177.858003,20.4560014 177.302,20.176 C176.745997,19.8959986 176.112004,19.756 175.4,19.756 C174.695996,19.756 174.080003,19.8839987 173.552,20.14 C173.023997,20.3960013 172.582002,20.7579977 172.226,21.226 C171.869998,21.6940023 171.602001,22.2539967 171.422,22.906 C171.241999,23.5580033 171.152,24.2759961 171.152,25.06 C171.152,26.8360089 171.477997,28.1419958 172.13,28.978 C172.782003,29.8140042 173.723994,30.232 174.956,30.232 C175.740004,30.232 176.455997,30.028002 177.104,29.62 C177.752003,29.211998 178.323998,28.6400037 178.82,27.904 L178.82,21.628 Z M179.96,13.54 L179.96,31 L179.336,31 C179.127999,31 179.008,30.896001 178.976,30.688 L178.856,28.804 C178.327997,29.5240036 177.712004,30.0959979 177.008,30.52 C176.303996,30.9440021 175.512004,31.156 174.632,31.156 C173.159993,31.156 172.016004,30.6480051 171.2,29.632 C170.383996,28.6159949 169.976,27.0920102 169.976,25.06 C169.976,24.1879956 170.089999,23.3740038 170.318,22.618 C170.546001,21.8619962 170.879998,21.2060028 171.32,20.65 C171.760002,20.0939972 172.301997,19.6560016 172.946,19.336 C173.590003,19.0159984 174.331996,18.856 175.172,18.856 C175.980004,18.856 176.679997,19.0039985 177.272,19.3 C177.864003,19.5960015 178.379998,20.0359971 178.82,20.62 L178.82,13.54 L179.96,13.54 Z M192.272,23.824 C192.272,23.1839968 192.182001,22.6100025 192.002,22.102 C191.821999,21.5939975 191.568002,21.1640018 191.24,20.812 C190.911998,20.4599982 190.522002,20.1900009 190.07,20.002 C189.617998,19.8139991 189.120003,19.72 188.576,19.72 C187.959997,19.72 187.408002,19.815999 186.92,20.008 C186.431998,20.200001 186.010002,20.4759982 185.654,20.836 C185.297998,21.1960018 185.012001,21.6279975 184.796,22.132 C184.579999,22.6360025 184.436,23.1999969 184.364,23.824 L192.272,23.824 Z M184.304,24.556 L184.304,24.784 C184.304,25.6800045 184.407999,26.4679966 184.616,27.148 C184.824001,27.8280034 185.119998,28.3979977 185.504,28.858 C185.888002,29.3180023 186.351997,29.6639988 186.896,29.896 C187.440003,30.1280012 188.047997,30.244 188.72,30.244 C189.320003,30.244 189.839998,30.1780007 190.28,30.046 C190.720002,29.9139993 191.089999,29.7660008 191.39,29.602 C191.690002,29.4379992 191.927999,29.2900007 192.104,29.158 C192.280001,29.0259993 192.408,28.96 192.488,28.96 C192.592001,28.96 192.672,28.9999996 192.728,29.08 L193.04,29.464 C192.847999,29.7040012 192.594002,29.927999 192.278,30.136 C191.961998,30.344001 191.610002,30.5219993 191.222,30.67 C190.833998,30.8180007 190.418002,30.9359996 189.974,31.024 C189.529998,31.1120004 189.084002,31.156 188.636,31.156 C187.819996,31.156 187.076003,31.0140014 186.404,30.73 C185.731997,30.4459986 185.156002,30.0320027 184.676,29.488 C184.195998,28.9439973 183.826001,28.2780039 183.566,27.49 C183.305999,26.7019961 183.176,25.8000051 183.176,24.784 C183.176,23.9279957 183.297999,23.1380036 183.542,22.414 C183.786001,21.6899964 184.137998,21.0660026 184.598,20.542 C185.058002,20.0179974 185.621997,19.6080015 186.29,19.312 C186.958003,19.0159985 187.715996,18.868 188.564,18.868 C189.236003,18.868 189.859997,18.9839988 190.436,19.216 C191.012003,19.4480012 191.511998,19.7859978 191.936,20.23 C192.360002,20.6740022 192.693999,21.2199968 192.938,21.868 C193.182001,22.5160032 193.304,23.2599958 193.304,24.1 C193.304,24.2760009 193.28,24.3959997 193.232,24.46 C193.184,24.5240003 193.104001,24.556 192.992,24.556 L184.304,24.556 Z M202.976,20.536 C202.912,20.6480006 202.820001,20.704 202.7,20.704 C202.612,20.704 202.500001,20.6540005 202.364,20.554 C202.227999,20.4539995 202.046001,20.3420006 201.818,20.218 C201.589999,20.0939994 201.308002,19.9820005 200.972,19.882 C200.635998,19.7819995 200.228002,19.732 199.748,19.732 C199.315998,19.732 198.922002,19.7939994 198.566,19.918 C198.209998,20.0420006 197.906001,20.207999 197.654,20.416 C197.401999,20.624001 197.208001,20.8659986 197.072,21.142 C196.935999,21.4180014 196.868,21.7079985 196.868,22.012 C196.868,22.3880019 196.963999,22.6999988 197.156,22.948 C197.348001,23.1960012 197.597998,23.4079991 197.906,23.584 C198.214002,23.7600009 198.567998,23.9119994 198.968,24.04 C199.368002,24.1680006 199.773998,24.2959994 200.186,24.424 C200.598002,24.5520006 201.003998,24.6939992 201.404,24.85 C201.804002,25.0060008 202.157998,25.1999988 202.466,25.432 C202.774002,25.6640012 203.023999,25.9479983 203.216,26.284 C203.408001,26.6200017 203.504,27.0279976 203.504,27.508 C203.504,28.0280026 203.412001,28.5119978 203.228,28.96 C203.043999,29.4080022 202.774002,29.7959984 202.418,30.124 C202.061998,30.4520016 201.624003,30.711999 201.104,30.904 C200.583997,31.096001 199.988003,31.192 199.316,31.192 C198.475996,31.192 197.752003,31.0580013 197.144,30.79 C196.535997,30.5219987 195.992002,30.1720022 195.512,29.74 L195.776,29.332 C195.816,29.2679997 195.862,29.2200002 195.914,29.188 C195.966,29.1559998 196.036,29.14 196.124,29.14 C196.228001,29.14 196.353999,29.2039994 196.502,29.332 C196.650001,29.4600006 196.847999,29.5979993 197.096,29.746 C197.344001,29.8940007 197.649998,30.0319994 198.014,30.16 C198.378002,30.2880006 198.827997,30.352 199.364,30.352 C199.868003,30.352 200.311998,30.2820007 200.696,30.142 C201.080002,30.0019993 201.399999,29.8120012 201.656,29.572 C201.912001,29.3319988 202.105999,29.0500016 202.238,28.726 C202.370001,28.4019984 202.436,28.0600018 202.436,27.7 C202.436,27.299998 202.340001,26.9680013 202.148,26.704 C201.955999,26.4399987 201.704002,26.2160009 201.392,26.032 C201.079998,25.8479991 200.726002,25.6920006 200.33,25.564 C199.933998,25.4359994 199.528002,25.3080006 199.112,25.18 C198.695998,25.0519994 198.290002,24.9120008 197.894,24.76 C197.497998,24.6079992 197.144002,24.4160012 196.832,24.184 C196.519998,23.9519988 196.268001,23.6700017 196.076,23.338 C195.883999,23.0059983 195.788,22.5920025 195.788,22.096 C195.788,21.6719979 195.879999,21.264002 196.064,20.872 C196.248001,20.479998 196.509998,20.1360015 196.85,19.84 C197.190002,19.5439985 197.603998,19.3080009 198.092,19.132 C198.580002,18.9559991 199.127997,18.868 199.736,18.868 C200.464004,18.868 201.109997,18.971999 201.674,19.18 C202.238003,19.388001 202.751998,19.7079978 203.216,20.14 L202.976,20.536 Z" fill="#02303A"></path></g></svg></a>
            <button type="button" aria-label="Navigation Menu" class="site-header__navigation-button hamburger">
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
            </button>
        </div>
        <div class="site-header__navigation-collapsible site-header__navigation-collapsible--collapse">
            <ul class="site-header__navigation-items">
                <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                            <span class="site-header__navigation-link">
                                Docs
                                <svg class="site-header__down-arrow site-header__icon-light" width="19" height="11" viewBox="0 0 19 11" xmlns="http://www.w3.org/2000/svg"><title>Open Docs Menu</title><path transform="rotate(-180 9.374 5.494)" d="M17.9991 10.422825L9.3741 0.565575 0.7491 10.422825" stroke="#02303A" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </span>
                    <div class="site-header__navigation-submenu">
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://docs.gradle.org/current/userguide/userguide.html" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">User Manual</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://guides.gradle.org" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Guides and Tutorials</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://docs.gradle.org/current/dsl/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">DSL Reference</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://docs.gradle.org/current/javadoc/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Javadoc</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://docs.gradle.org/current/release-notes.html" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Release Notes</span>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://discuss.gradle.org/" itemprop="url">Forums</a>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.org/training/" itemprop="url">Training</a>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.com/enterprise" itemprop="url">Try Gradle Enterprise</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<main class="main-content">
    <nav class="docs-navigation">
        <ul>
            <li><a href="https://docs.gradle.org/current/userguide/userguide.html">User Manual</a></li>
            <li><a href="https://guides.gradle.org">Tutorials</a></li>
            <li><a href="https://docs.gradle.org/current/dsl/">DSL Reference</a></li>
            <li><a href="https://docs.gradle.org/current/release-notes.html">Release Notes</a></li>
        </ul>

        <h3 id="getting-started">Getting Started</h3>
        <ul>
            <li><a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating New Gradle Builds</a></li>
            <li><a href="https://guides.gradle.org/creating-build-scans/">Creating Build Scans</a></li>
            <li><a href="https://guides.gradle.org/migrating-from-maven/">Migrating From Maven</a></li>
        </ul>

        <h3 id="tutorials">Project Tutorials</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-android-projects" aria-expanded="false" aria-controls="building-android-projects">Android</a>
                <ul id="building-android-projects">
                    <li><a href="https://guides.gradle.org/building-android-apps/">Building Android Apps</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-cpp-projects" aria-expanded="false" aria-controls="building-cpp-projects">C++</a>
                <ul id="building-cpp-projects">
                    <li><a href="https://guides.gradle.org/building-cpp-executables/">Building C++ Executables</a></li>
                    <li><a href="https://guides.gradle.org/building-cpp-libraries/">Building C++ Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-groovy-projects" aria-expanded="false" aria-controls="building-groovy-projects">Groovy</a>
                <ul id="building-groovy-projects">
                    <li><a href="https://guides.gradle.org/building-groovy-libraries/">Building Groovy Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-java-projects" aria-expanded="false" aria-controls="building-java-projects">Java</a>
                <ul id="building-java-projects">
                    <li><a href="https://guides.gradle.org/building-java-applications/">Building Java Applications</a></li>
                    <li><a href="https://guides.gradle.org/building-java-libraries/">Building Java Libraries</a></li>
                    <li><a href="https://guides.gradle.org/building-java-9-modules/">Building Java 9 Modules</a></li>
                    <li><a href="https://guides.gradle.org/building-java-web-applications/">Building Java Web Applications</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-javascript-projects" aria-expanded="false" aria-controls="building-javascript-projects">JavaScript</a>
                <ul id="building-javascript-projects">
                    <li><a href="https://guides.gradle.org/running-webpack-with-gradle/">Running Webpack with Gradle</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-kotlin-projects" aria-expanded="false" aria-controls="building-kotlin-projects">Kotlin</a>
                <ul id="building-kotlin-projects">
                    <li><a href="https://guides.gradle.org/building-kotlin-jvm-libraries/">Building Kotlin JVM Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-scala-projects" aria-expanded="false" aria-controls="building-scala-projects">Scala</a>
                <ul id="building-scala-projects">
                    <li><a href="https://guides.gradle.org/building-scala-libraries/">Building Scala Libraries</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="integrating-gradle">Integrating Gradle</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#ci-integration" aria-expanded="false" aria-controls="ci-integration">Continuous Integration</a>
                <ul id="ci-integration">
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-jenkins">Using Gradle with Jenkins</a></li>
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-teamcity">Using Gradle with TeamCity</a></li>
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-travisci">Using Gradle with Travis CI</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="developing-gradle-plugins">Extending Gradle</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#plugins-tutorials" aria-expanded="false" aria-controls="plugins-tutorials">Plugin Development Guides</a>
                <ul id="plugins-tutorials">
                    <li><a href="https://guides.gradle.org/designing-gradle-plugins/">Designing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/implementing-gradle-plugins/">Implementing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/testing-gradle-plugins/">Testing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/publishing-plugins-to-gradle-plugin-portal/">Publishing Gradle Plugins</a></li>
                </ul>
            </li>
            <li><a href="https://guides.gradle.org/using-the-worker-api/">Developing Parallel Tasks</a></li>
        </ul>
    </nav>
    <div class="chapter">
<div id="header">
<h1>Building Java 9 Modules</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One of the most exciting features of Java 9 is its support for developing and
deploying modular Java software. In this guide, you&#8217;ll learn exactly what you
need to change in your Java application to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>produce Java 9 modules for your java libraries.</p>
</li>
<li>
<p>consume Java 9 modules as your dependencies.</p>
</li>
<li>
<p>use Java&#8217;s <code>ServiceLoader</code> pattern with Java 9 modules.</p>
</li>
<li>
<p>run an application using Java 9 modules.</p>
</li>
<li>
<p>use an experimental plugin to do all of this more simply.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While Gradle version 4.7 doesn&#8217;t have first-class support for
Java 9 modules yet, this guide shows you how to experiment with them before that
support is complete.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Currently, this guide has been tested with IDEA but does not work with
Eclipse Oxygen.3a Release (4.7.3a), due to classpath/modulepath <a href="https://github.com/eclipse/buildship/issues/708">issues</a>.
</td>
</tr>
</table>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#what_you_ll_need">What you&#8217;ll need</a></li>
<li><a href="#understanding_the_example_project">Understanding the Example Project</a></li>
<li><a href="#step_1_produce_a_java_9_module_for_a_single_subproject">Step 1 - Produce a Java 9 module for a single subproject</a></li>
<li><a href="#step_2_produce_java_9_modules_for_all_subprojects">Step 2 - Produce Java 9 modules for all subprojects</a></li>
<li><a href="#step_3_consume_java_9_modules_in_the_code_run_code_and_code_assemble_code_tasks">Step 3 - Consume Java 9 modules in the <code>run</code> and <code>assemble</code> tasks</a></li>
<li><a href="#step_4_use_the_code_experimental_jigsaw_code_plugin_to_do_the_same_thing">Step 4 - Use the <code>experimental-jigsaw</code> plugin to do the same thing</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#help_improve_this_guide">Help improve this guide</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_need"><a class="anchor" href="#what_you_ll_need"></a><a class="link" href="#what_you_ll_need">What you&#8217;ll need</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>About <span class="time-to-complete-text">60 minutes</span></p>
</li>
<li>
<p>A text editor</p>
</li>
<li>
<p>A command prompt</p>
</li>
<li>
<p>The Java Development Kit (JDK), version 1.9 (build 174) or newer</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding_the_example_project"><a class="anchor" href="#understanding_the_example_project"></a><a class="link" href="#understanding_the_example_project">Understanding the Example Project</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide explains step-by-step how to convert an example Java application
which doesn&#8217;t use any Java 9 features into a fully-modular Java 9 application.
The source code for the original version of the application lives in the
<code>src/0-original</code> directory. It is organized as multi-project Gradle build made
up of six subprojects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fairy</code> - The entry point to the storyteller java application.</p>
</li>
<li>
<p><code>tale</code> - A library which defines the public <code>Tale</code> interface.</p>
</li>
<li>
<p><code>formula</code> - A library which makes it easy to weave a <code>Tale</code>.</p>
</li>
<li>
<p><code>actors</code> - A library which represents the characters in a fairy tale.</p>
</li>
<li>
<p><code>pigs</code> - A library which produces an instance of <code>Tale</code> which represents the
story of the three little pigs.</p>
</li>
<li>
<p><code>bears</code> - A library which produces an instance of <code>Tale</code> which represents the
story of Goldilocks and the three bears.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The project hierarchy showing the dependency relationships between the six
projects can be seen in the following illustration:</p>
</div>
<div id="fig-1" class="imageblock">
<div class="content">
<img src="images/project-graph.png" alt="Project Graph">
</div>
<div class="title">Figure 1: Project Graph</div>
</div>
<div class="paragraph">
<p>If the <code>api</code> and <code>implementation</code> configurations are new to you, read more
about the
<a href="https://docs.gradle.org/current/userguide/java_library_plugin.html">Java Library Plugin</a>
added in Gradle 3.5.</p>
</div>
<div class="paragraph">
<p>You can clone the project and run the original program to see its output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git clone https://github.com/gradle-guides/building-java-9-modules.git
$ cd building-java-9-modules/src/0-original
$ ./gradlew run

&gt; Task :fairy:run
Once upon a time, there lived the big bad wolf, and the 3 little pigs.

&lt;... elided ...&gt;

Goldilocks ran out of the house at top speed to escape the 3 bears.
And they all lived happily ever after.


BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Before you start modifying this project to have it use Java 9 modules, you need
to understand two important details of how the project is structured. Namely,
that it uses the
<a href="https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>
api to load the fairy tales at runtime, and that it contains a test class that
shows how software modularity was broken before Java 9.</p>
</div>
<div class="sect2">
<h3 id="serviceloader_usage"><a class="anchor" href="#serviceloader_usage"></a><a class="link" href="#serviceloader_usage">ServiceLoader usage</a></h3>
<div class="paragraph">
<p>Java 1.6 introduced a simple mechanism for binding a set of implementations of
some interface (the "Service") to a consuming class at runtime. Oracle&#8217;s
<a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html">tutorial</a> on the
topic is a bit lengthy, but here&#8217;s how it is used in our sample application:</p>
</div>
<div class="listingblock">
<div class="title">fairy/src/main/java/org/gradle/fairy/app/StoryTeller.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">    public static void main(String[] args) {
        ServiceLoader&lt;Tale&gt; loader = ServiceLoader.load(Tale.class);
        if (!loader.iterator().hasNext()) {
            System.out.println("Alas, I have no tales to tell!");
        }
        for (Tale tale : loader) {
            tale.tell();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ServiceLoader</code> coordinates with the JVM&#8217;s ClassLoader to find instances of
the <code>Tale</code> class which have been specified in special files named
<code>org.gradle.fairy.tale.Tale</code> in <code>META-INF/services</code> folders on the classpath.</p>
</div>
<div class="listingblock">
<div class="title">bears/src/main/resources/META-INF/services/org.gradle.fairy.tale.Tale</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">org.gradle.fairy.tale.bears.GoldilocksAndTheThreeBears</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">pigs/src/main/resources/META-INF/services/org.gradle.fairy.tale.Tale</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">org.gradle.fairy.tale.pigs.ThreeLittlePigs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loading these instances at runtime gives the <code>StoryTeller</code> class the loosest
possible coupling to the two libraries which implement the <code>Tale</code> interface.
You can see this in the <code>dependencies</code> block of the <code>build.gradle</code> file for the
application.</p>
</div>
<div class="listingblock">
<div class="title">fairy/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    implementation project(':tale')

    runtimeOnly project(':pigs')
    runtimeOnly project(':bears')
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In fact, comment out both of the lines that start with <code>runtimeOnly</code> and notice how the output of Gradle&#8217;s <code>run</code> task changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew run

&gt; Task :fairy:run
Alas, I have no tales to tell!


BUILD SUCCESSFUL</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modularitytest_discussion"><a class="anchor" href="#modularitytest_discussion"></a><a class="link" href="#modularitytest_discussion">ModularityTest discussion</a></h3>
<div class="paragraph">
<p>In the original project, there is a test class which attempts to highlight some
of the problems with how modularity wasn&#8217;t enforced in Java versions prior to 9.</p>
</div>
<div class="listingblock">
<div class="title">formula/src/test/java/org/gradle/fairy/tale/formula/ModularityTest.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">    @Test
    public void canReachActor() {
        Actor actor = Imagination.createActor("Sean Connery");
        assertEquals("Sean Connery", actor.toString());
    }

    @Test
    public void canDynamicallyReachDefaultActor() throws Exception {
        Class clazz = ModularityTest
            .class.getClassLoader()
            .loadClass("org.gradle.actors.impl.DefaultActor");
        Actor actor = (Actor) clazz.getConstructor(String.class)
            .newInstance("Kevin Costner");
        assertEquals("Kevin Costner", actor.toString());
    }

    @Test
    public void canReachDefaultActor() {
        Actor actor = new org.gradle.actors.impl.DefaultActor("Kevin Costner");
        assertEquals("Kevin Costner", actor.toString());
    }

    /*
    @Test
    public void canReachGuavaClasses() {
        // This line would throw a compiler error because gradle has kept the implementation dependency "guava"
        // from leaking into the formula project.
        Set&lt;String&gt; strings = com.google.common.collect.ImmutableSet.of("Hello", "Goodbye");
        assertTrue(strings.contains("Hello"));
        assertTrue(strings.contains("Goodbye"));
    }
    */</code></pre>
</div>
</div>
<div class="paragraph">
<p>The four tests in this class serve different purposes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>canReachActor</code> - Shows appropriate access by a class in the <code>formula</code>
subproject using classes exposed as part of the <code>actors</code> project&#8217;s public
api. This test should always pass.</p>
</li>
<li>
<p><code>canDynamicallyReachDefaultActor</code> - Attempts to use reflection at runtime
to load a class which is private to the <code>actors</code> subproject. This was
possible before Java 9 because the classpath leaks the implementation details
of all parts of the application to all other parts of the application.</p>
</li>
<li>
<p><code>canReachDefaultActor</code> - Attempts to use a class which is private to the
<code>actors</code> subproject directly. This will work before Java 9 because the
private implementation details of the <code>actors</code> subproject are built in the
same location as the public api of that subproject. So, they are available
at compile-time and at runtime.</p>
</li>
<li>
<p><code>canReachGuavaClasses</code> - Attempts to use a class which is a transitive
dependency of the <code>actors</code> subproject. However, since Gradle 3.4, these
<code>implementation</code> dependencies are not included on the <code>compileClasspath</code> of
the consumers of Java projects. So, this test is commented out because it
wouldn&#8217;t compile with Gradle 3.4 and newer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you progress through this guide, you&#8217;ll see that Java 9 modules tighten down
inappropriate access to implementation details of the module, and cause tests
like <code>canDynamicallyReachDefaultActor</code> and <code>canReachDefaultActor</code> to fail at
runtime and not compile, respectively.</p>
</div>
<div class="paragraph">
<p>You can run Gradle&#8217;s <code>check</code> task to see that the three tests pass for the
<code>0-original</code> project (even though two of them are breaking good modular design.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew check

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>You can view the results of an invocation of Gradle&#8217;s <code>check</code> task at
<a href="https://scans.gradle.com/s/l76lgbuizu4pm/tests/byProject?toggled=W1sxXSxbMSwwXSxbMSwwLDBdLFsxLDAsMCwwXV0%3D">this build scan.</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step_1_produce_a_java_9_module_for_a_single_subproject"><a class="anchor" href="#step_1_produce_a_java_9_module_for_a_single_subproject"></a><a class="link" href="#step_1_produce_a_java_9_module_for_a_single_subproject">Step 1 - Produce a Java 9 module for a single subproject</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you aren&#8217;t already familiar with the Java 9 module system, you should read:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://openjdk.java.net/projects/jigsaw/quick-start">Module System Quick-Start Guide</a> (at least)</p>
</li>
<li>
<p><a href="http://openjdk.java.net/projects/jigsaw/spec/sotms/">The State of The Module System</a> (for more details)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide assumes that you already have familiarity with the following concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The module path</p>
</li>
<li>
<p>Automatic modules</p>
</li>
<li>
<p>The basic syntax of <code>module-info.java</code> files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One nice feature of the module system in Java 9, is that you can convert all
of the libraries of your project to Java 9 modules in a bottom-up fashion.
Since Java 9 module jars can be consumed equally well from the classpath or the
module path, we can convert a single leaf-node in our multi-project build to
produce a Java 9 module, but use that module jar on the classpath when
compiling or running projects which consume the outputs of that node.</p>
</div>
<div class="paragraph">
<p>When converting a <code>java-library</code> project to produce a Java 9 module, there are
five changes you should to make to your project.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a <code>module-info.java</code> describing the module.</p>
</li>
<li>
<p>Modify the <code>compileJava</code> task to produce a module.</p>
</li>
<li>
<p>Modify the <code>compileTestJava</code> task to locally alter the module.</p>
</li>
<li>
<p>Modify the <code>test</code> task to consume the locally altered module.</p>
</li>
<li>
<p>(Optional) Add <code>Automatic-Module-Name</code> manifest entries for all other
projects.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend proactively adding an <code>Automatic-Module-Name</code> manifest entry in the
<code>META-INF/MANIFEST.MF</code> file for all of the projects which make up your
application. Providing an <code>Automatic-Module-Name</code> allows library authors to
reserve a module name for the future, without having to actually convert the
library to a module. This ensures that consumers of the library know right now
what the module name will be in the future. Doing this is described in the
optional 5th change.</p>
</div>
<div class="paragraph">
<p>Each of these changes is described in subsections below along with discussion
of why the change is being made. You can also view the results of these
changes by exploring the <code>src/1-single-module</code> example project in the
repository.</p>
</div>
<div class="paragraph">
<p>Our goal in making the following five changes is to have the <code>actors</code> project
produce a Java 9 module. The first four changes need to be made together, and
the fifth (optional) change can be made independently.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As a reminder, all builds from this point on need to run on Java 9.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="add_a_code_module_info_java_code_describing_the_module"><a class="anchor" href="#add_a_code_module_info_java_code_describing_the_module"></a><a class="link" href="#add_a_code_module_info_java_code_describing_the_module">Add a <code>module-info.java</code> describing the module.</a></h3>
<div class="paragraph">
<p>Add a <code>module-info.java</code> file to the project&#8217;s <code>actors/src/main/java</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">actors/src/main/java/module-info.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">module org.gradle.actors {
    exports org.gradle.actors;
    requires guava;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This file declares the <code>org.gradle.actors</code> module which exports the
<code>org.gradle.actors</code> package (but not the <code>org.gradle.actors.impl</code> package) and
requires the <code>guava</code> module. The Guava jar files are not yet Java 9 modules,
so when you require them, you have to use the automatic module name <code>guava</code>
which the JVM infers from the filename of the jar file which contains the
classes. For Guava, the jar file&#8217;s name is
<a href="http://central.maven.org/maven2/com/google/guava/guava/22.0/">guava-22.0.jar</a>, so according to the
<a href="http://openjdk.java.net/projects/jigsaw/spec/sotms/#automatic-modules">rules of automatic module names</a>,
you require <code>guava</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="modify_the_code_compilejava_code_task_to_produce_a_module"><a class="anchor" href="#modify_the_code_compilejava_code_task_to_produce_a_module"></a><a class="link" href="#modify_the_code_compilejava_code_task_to_produce_a_module">Modify the <code>compileJava</code> task to produce a module.</a></h3>
<div class="paragraph">
<p>In the <code>build.gradle</code> file for the <code>actors</code> subproject, add the following.</p>
</div>
<div class="listingblock">
<div class="title">actors/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">ext.moduleName = 'org.gradle.actors' <i class="conum" data-value="1"></i><b>(1)</b>

compileJava {
    inputs.property("moduleName", moduleName)
    doFirst {
        options.compilerArgs = [
            '--module-path', classpath.asPath,
        ]
        classpath = files()  <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a variable for the module name, which allows you to
reuse the same code later for other modules without having to change it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Clears the <code>classpath</code> property by creating an empty file collection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When compiling a Java 9 module, you want to use <code>--module-path</code> instead of
<code>--classpath</code> to read your dependencies. So in the <code>doFirst</code> block, you are
clearing out the <code>classpath</code> property of the task and adding a compiler
argument.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--module-path</code> is set to the value that would have been the <code>classpath</code>. This
makes sense because the classpath already has any jars or class output
directories of libraries on which you depend.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The reason you modify <code>options.compilerArgs</code> inside the <code>doFirst</code> block
instead of in the configuration block of the <code>compileJava</code> task is because you
only want resolve the <code>compileClasspath</code> configuration when executing that task.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="modify_the_code_compiletestjava_code_task_to_locally_alter_the_module"><a class="anchor" href="#modify_the_code_compiletestjava_code_task_to_locally_alter_the_module"></a><a class="link" href="#modify_the_code_compiletestjava_code_task_to_locally_alter_the_module">Modify the <code>compileTestJava</code> task to locally alter the module</a></h3>
<div class="paragraph">
<p>One slightly confusing aspect of the Java 9 module system is how to run unit
tests for code inside a Java 9 module. The recommended way is to "patch" the
module during testing. Patching a module means adding extra classes to the
packages which make up the module. In the case of patching a module for running
tests, you are adding the test classes to the module, using the same package so
that the test classes have access to everything else in the module under test.</p>
</div>
<div class="paragraph">
<p>Adding the following to your <code>build.gradle</code> accomplishes this compile-time
patching of the <code>org.gradle.actors</code> module.</p>
</div>
<div class="listingblock">
<div class="title">actors/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">compileTestJava {
    inputs.property("moduleName", moduleName)
    doFirst {
        options.compilerArgs = [
            '--module-path', classpath.asPath, <i class="conum" data-value="1"></i><b>(1)</b>
            '--add-modules', 'junit',  <i class="conum" data-value="2"></i><b>(2)</b>
            '--add-reads', "$moduleName=junit", <i class="conum" data-value="3"></i><b>(3)</b>
            '--patch-module', "$moduleName=" + files(sourceSets.test.java.srcDirs).asPath, <i class="conum" data-value="4"></i><b>(4)</b>
        ]
        classpath = files()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the default value for the <code>classpath</code> property used as the
<code>--module-path</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Explicitly adds the automatic <code>junit</code> module to the set of observable
modules.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declares that <code>junit</code> reads the <code>org.gradle.actors</code> module.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adds the test source files to the <code>org.gradle.actors</code> module.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These options cause the generated class files in the <code>test</code> source set&#8217;s
<code>java.outputDir</code> to contain appropriate metadata used to patch the
<code>org.gradle.actors</code> module. Those class files are consumed in the next change.</p>
</div>
</div>
<div class="sect2">
<h3 id="modify_the_code_test_code_task_to_consume_the_locally_altered_module"><a class="anchor" href="#modify_the_code_test_code_task_to_consume_the_locally_altered_module"></a><a class="link" href="#modify_the_code_test_code_task_to_consume_the_locally_altered_module">Modify the <code>test</code> task to consume the locally altered module</a></h3>
<div class="paragraph">
<p>When running the tests, we have to configure the JVM that will be running the
tests to know about our modules and to patch the <code>org.gradle.actors</code> module
to include the test classes.</p>
</div>
<div class="paragraph">
<p>Add the following to the <code>build.gradle</code> file in the <code>actors</code> project.</p>
</div>
<div class="listingblock">
<div class="title">actors/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">test {
    inputs.property("moduleName", moduleName)
    doFirst {
        jvmArgs = [
            '--module-path', classpath.asPath, <i class="conum" data-value="1"></i><b>(1)</b>
            '--add-modules', 'ALL-MODULE-PATH', <i class="conum" data-value="2"></i><b>(2)</b>
            '--add-reads', "$moduleName=junit", <i class="conum" data-value="3"></i><b>(3)</b>
            '--patch-module', "$moduleName=" + files(sourceSets.test.java.outputDir).asPath, <i class="conum" data-value="4"></i><b>(4)</b>
        ]
        classpath = files()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the default value for the <code>classpath</code> property at test runtime.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the special <code>ALL-MODULE-PATH</code>, because the main class of the
JVM that is running the tests is not part of a Java 9 module. It is Gradle&#8217;s
test runner, so it declares no modules it needs to consume. This argument makes
all of the modules in the module path visible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declares that <code>junit</code> reads the <code>org.gradle.actors</code> module.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adds the test classes to the <code>org.gradle.actors</code> module.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point, you can actually run the tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="optional_add_code_automatic_module_name_code_manifest_entries_for_all_other_projects"><a class="anchor" href="#optional_add_code_automatic_module_name_code_manifest_entries_for_all_other_projects"></a><a class="link" href="#optional_add_code_automatic_module_name_code_manifest_entries_for_all_other_projects">(Optional) - Add <code>Automatic-Module-Name</code> manifest entries for all other projects</a></h3>
<div class="paragraph">
<p>For backwards compatibility, Java 9&#8217;s module system allows non-module jar files
to appear on the module path. By default, these jar files are converted to
automatic modules whose names are based on the filename of the jar file. This
creates a bit of complexity though. Many jar filenames have been created without
any attempt to make the names globally unique. So it is very likely that, when
the developers responsible for maintaining some commonly used jar actually
convert that jar to a Java 9 module, they&#8217;ll choose a different module name than
the one automatically chosen for a previous non-module version of their jar.</p>
</div>
<div class="paragraph">
<p>For example, you might specify <code>requires guava</code> in a <code>module-info.java</code> file
today, but later the developers responsible for the project decide to name
their module <code>com.google.guava</code>. Now anyone who has specified <code>requires guava</code>,
or anyone who transitively depends on such a module, will have to wait for
all of the modules they depend on to change to <code>requires com.google.guava</code>
before they can adopt any of those new modules, because Java 9 only allows
one module on the module path to include any specific package.</p>
</div>
<div class="paragraph">
<p>The whole situation can get quite messy. This is why
<a href="http://blog.joda.org/2017/05/java-se-9-jpms-automatic-modules.html">Stephen Colebourne argues</a>
that we should immediately start updating all of the jars we publish to public
repositories to (at least) specify an <code>Automatic-Module-Name</code> attribute in
the jar&#8217;s manifest, and not to publish any artifacts which
contain modules that require automatic modules where that attribute has not
been specified.</p>
</div>
<div class="paragraph">
<p>So, in each <code>build.gradle</code> file for each subproject specify a <code>moduleName</code>
variable. For example:</p>
</div>
<div class="listingblock">
<div class="title">fairy/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">ext.moduleName = 'org.gradle.fairy.app'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, in the top-level <code>build.gradle</code> file inside the <code>afterEvaluate</code> block,
tell the <code>jar</code> task to include the manifest attribute.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">        jar {
            inputs.property("moduleName", moduleName)
            manifest {
                attributes('Automatic-Module-Name': moduleName)
            }
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it doesn&#8217;t matter what you name your jar files when you publish them to
an artifact repository like Maven Central; you&#8217;ll be sure you get the Java 9
module name you want.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You&#8217;ll be getting rid of these manifest attributes in the next step, since
you will have converted each subproject into a proper Java 9 module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="step_1_summary"><a class="anchor" href="#step_1_summary"></a><a class="link" href="#step_1_summary">Step 1 - Summary</a></h3>
<div class="paragraph">
<p>This first step is the most complicated, but now you have converted your
first <code>java-library</code> project into a Java 9 module. All of the other subprojects
consume that module on the classpath. So we haven&#8217;t really addressed any of
the modularity violations demonstrated in
<a href="#modularitytest_discussion">ModularityTest</a>, but we didn&#8217;t have to break
the project to convert one of its logical architectural units into a proper
Java 9 module. Next you&#8217;ll centralize the gradle changes into the root
<code>build.gradle</code> project, and apply it to all of the subprojects.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step_2_produce_java_9_modules_for_all_subprojects"><a class="anchor" href="#step_2_produce_java_9_modules_for_all_subprojects"></a><a class="link" href="#step_2_produce_java_9_modules_for_all_subprojects">Step 2 - Produce Java 9 modules for all subprojects</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of this step is to make all of the subprojects in our Gradle build
produce Java 9 modules, and consume their dependencies as Java 9 modules. Since
you already have the <code>moduleName</code> variable declaration separate from the other
changes in the <code>build.gradle</code> file in the <code>actors</code> subproject, it&#8217;s just a
matter of cutting everything from below the <code>moduleName</code> declaration in that
file and pasting it into the <code>afterEvaluate</code> block in the root <code>build.gradle</code>
file.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">subprojects {
    afterEvaluate {
        repositories {
            jcenter()
        }

        compileJava {
            inputs.property("moduleName", moduleName)
            doFirst {
                options.compilerArgs = [
                    '--module-path', classpath.asPath,
                ]
                classpath = files()
            }
        }

        compileTestJava {
            inputs.property("moduleName", moduleName)
            doFirst {
                options.compilerArgs = [
                    '--module-path', classpath.asPath,
                    '--add-modules', 'junit',
                    '--add-reads', "$moduleName=junit",
                    '--patch-module', "$moduleName=" + files(sourceSets.test.java.srcDirs).asPath,
                ]
                classpath = files()
            }
        }

        test {
            inputs.property("moduleName", moduleName)
            doFirst {
                jvmArgs = [
                    '--module-path', classpath.asPath,
                    '--add-modules', 'ALL-MODULE-PATH',
                    '--add-reads', "$moduleName=junit",
                    '--patch-module', "$moduleName=" + files(sourceSets.test.java.outputDir).asPath,
                ]
                classpath = files()
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you did
<a href="#change_6_optional_add_code_atomatic_module_name_code_manifest_entries_for_all_other_projects">Change 6</a>
from Step 1, you should remove the <code>jar</code> block before pasting.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you haven&#8217;t already added <code>moduleName</code> variable declarations for each of the
subprojects, you should do that now. For example:</p>
</div>
<div class="listingblock">
<div class="title">pigs/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">ext.moduleName = 'org.gradle.fairy.tale.pigs'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need to add a <code>module-info.java</code> file for each of your subprojects.
For example:</p>
</div>
<div class="listingblock">
<div class="title">bears/src/main/java/module-info.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">module org.gradle.fairy.tale.bears {
    requires org.gradle.actors;
    requires transitive org.gradle.fairy.tale;
    requires org.gradle.fairy.tale.formula;

    exports org.gradle.fairy.tale.bears;
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You also have to add these <code>module-info.java</code> files for the <code>pigs</code>,
<code>formula</code>, <code>fairy</code>, and <code>tale</code> subprojects. The end results should look like
the code in <code>src/2-all-modules</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now Gradle&#8217;s <code>test</code> task will fail to compile, unless you&#8217;ve
commented out the <code>canReachDefaultActor</code> test. Also, the
<code>canDynamicallyReachDefaultActor</code> test will fail at test runtime unless you
<code>@Ignore</code> it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew test

&gt; Task :formula:test

org.gradle.fairy.tale.formula.ModularityTest &gt; canDynamicallyReachDefaultActor FAILED
    java.lang.IllegalAccessException at ModularityTest.java:28

2 tests completed, 1 failed


FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':formula:test'.
&gt; There were failing tests. See the report at: &lt;link-to-report&gt;

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.

BUILD FAILED</pre>
</div>
</div>
<div class="paragraph">
<p>If you do comment out <code>canReachDefaultActor</code> and add the <code>@Ignore</code> annotation to
 <code>canDynamicallyReachDefaultActor</code>, the remaining tests should pass, and you&#8217;ll
 have exactly the code in <code>src/2-all-modules</code></p>
</div>
<div class="sect2">
<h3 id="step_2_summary"><a class="anchor" href="#step_2_summary"></a><a class="link" href="#step_2_summary">Step 2 - Summary</a></h3>
<div class="paragraph">
<p>At this point in the guide, you are now compiling and running tests for all six
of the subprojects using Java 9 modules. The subprojects are appropriately
encapsulated, and none of the tests from one package can see implementation
details of any of their dependencies. However, there are a few features
of Gradle&#8217;s <a href="https://docs.gradle.org/4.7/userguide/application_plugin.html">Application Plugin</a> which are
relying on the classpath instead of the module path to load and resolve classes.</p>
</div>
<div class="paragraph">
<p>Also, Java 9 adds a more convenient way to use the <code>ServiceLoader</code> feature.
You&#8217;ll handle all of these in Step 3.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step_3_consume_java_9_modules_in_the_code_run_code_and_code_assemble_code_tasks"><a class="anchor" href="#step_3_consume_java_9_modules_in_the_code_run_code_and_code_assemble_code_tasks"></a><a class="link" href="#step_3_consume_java_9_modules_in_the_code_run_code_and_code_assemble_code_tasks">Step 3 - Consume Java 9 modules in the <code>run</code> and <code>assemble</code> tasks</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have all of the subprojects producing Java 9 modules, it&#8217;s time to
learn how to consume those modules when running the main class
<code>org.gradle.fairy.app.StoryTeller</code> from the <code>fairy</code> project.</p>
</div>
<div class="paragraph">
<p>There are two ways run the app covered in this guide. The first is to use
Gradle&#8217;s <code>run</code> task which is added by
<a href="https://docs.gradle.org/4.7/userguide/application_plugin.html">the Application Plugin</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew run

&gt; Task :fairy:run
Once upon a time, there lived the big bad wolf, and the 3 little pigs.

&lt;... elided ...&gt;

Goldilocks ran out of the house at top speed to escape the 3 bears.
And they all lived happily ever after.


BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>The other way is to create a distribution of the application using Gradle&#8217;s
<code>assemble</code> task, then extract the distribution to some directory and run it
from there.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew assemble

BUILD SUCCESSFUL
$ cp fairy/build/distributions/fair.tar /tmp
$ cd /tmp
$ tar xvf fairy.tar
x fairy/
x fairy/lib/
x fairy/lib/fairy.jar
x fairy/lib/pigs.jar
x fairy/lib/bears.jar
x fairy/lib/formula.jar
x fairy/lib/tale.jar
x fairy/lib/actors.jar
x fairy/lib/guava-22.0.jar
x fairy/lib/jsr305-1.3.9.jar
x fairy/lib/error_prone_annotations-2.0.18.jar
x fairy/lib/j2objc-annotations-1.1.jar
x fairy/lib/animal-sniffer-annotations-1.14.jar
x fairy/bin/
x fairy/bin/fairy
x fairy/bin/fairy.bat
$ ./bin/fairy
Once upon a time, there lived the big bad wolf, and the 3 little pigs.

&lt;... elided ...&gt;

Goldilocks ran out of the house at top speed to escape the 3 bears.
And they all lived happily ever after.</pre>
</div>
</div>
<div class="paragraph">
<p>After Step 2, both of those mechanisms rely on modules which
appear on the classpath. That skips the modularity features of the Java 9
module system. In this step, you will:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the <code>run</code> task to use modules.</p>
</li>
<li>
<p>Modify the <code>startScript</code> task for both *nix and Windows to use modules.</p>
</li>
<li>
<p>Update the <code>ServiceLoader</code> mechanism to the Java 9 syntax.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once you&#8217;ve made changes 1 and 2, both mechanisms for running the program should
continue working, so feel free to run those commands again to confirm you have
correctly implemented each change.</p>
</div>
<div class="paragraph">
<p>For the impatient, you can see all of the changes together in the
<code>src/3-application</code> directory in the repository.</p>
</div>
<div class="sect2">
<h3 id="modify_the_code_run_code_task_to_use_modules"><a class="anchor" href="#modify_the_code_run_code_task_to_use_modules"></a><a class="link" href="#modify_the_code_run_code_task_to_use_modules">Modify the <code>run</code> task to use modules</a></h3>
<div class="paragraph">
<p>To get the <code>run</code> task working with your new Java 9 modules, add the following
to the <code>build.gradle</code> file in the <code>fairy</code> project.</p>
</div>
<div class="listingblock">
<div class="title">fairy/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">mainClassName = "$moduleName/org.gradle.fairy.app.StoryTeller" <i class="conum" data-value="1"></i><b>(1)</b>

run {
    inputs.property("moduleName", moduleName)
    doFirst {
        jvmArgs = [
            '--module-path', classpath.asPath,
            '--module', mainClassName <i class="conum" data-value="2"></i><b>(2)</b>
        ]
        classpath = files()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the <code>mainClassName</code> to include the moduleName.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Explicitly tell Java 9 to use the module.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="modify_the_code_startscript_code_task_for_both_nix_and_windows_to_use_modules"><a class="anchor" href="#modify_the_code_startscript_code_task_for_both_nix_and_windows_to_use_modules"></a><a class="link" href="#modify_the_code_startscript_code_task_for_both_nix_and_windows_to_use_modules">Modify the <code>startScript</code> task for both *nix and Windows to use modules</a></h3>
<div class="paragraph">
<p>The tar and zip files created in the <code>fairy/build/distributions</code> directory
contain <a href="https://docs.gradle.org/4.7/userguide/application_plugin.html#sec:the_distribution">start scripts</a>
which allow the JVM to be started in a predictable way on all supported
operating systems.</p>
</div>
<div class="paragraph">
<p>To modify those generated <code>startScripts</code>, add the following to your
<code>fairy/build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="title">fairy/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">startScripts {
    inputs.property("moduleName", moduleName)
    doFirst {
        classpath = files()
        defaultJvmOpts = [
            '--module-path', 'APP_HOME_LIBS',  <i class="conum" data-value="1"></i><b>(1)</b>
            '--module', mainClassName
        ]
    }
    doLast{
        def bashFile = new File(outputDir, applicationName)
        String bashContent = bashFile.text
        bashFile.text = bashContent.replaceFirst('APP_HOME_LIBS', Matcher.quoteReplacement('$APP_HOME/lib'))

        def batFile = new File(outputDir, applicationName + ".bat")
        String batContent = batFile.text
        batFile.text = batContent.replaceFirst('APP_HOME_LIBS', Matcher.quoteReplacement('%APP_HOME%\\lib'))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the module path to a platform-independent placeholder value which is
later replaced in a platform-specific way for the *nix shell script and Windows
<code>.bat</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="update_the_code_serviceloader_code_mechanism_to_the_java_9_syntax"><a class="anchor" href="#update_the_code_serviceloader_code_mechanism_to_the_java_9_syntax"></a><a class="link" href="#update_the_code_serviceloader_code_mechanism_to_the_java_9_syntax">Update the <code>ServiceLoader</code> mechanism to the Java 9 syntax</a></h3>
<div class="paragraph">
<p>The Java 9 module system introduces a better way to specify which modules
provide implementations of a service for the <code>ServiceLoader</code> mechanism.
First, delete the <code>resources</code> directories from both <code>bears/src/main</code> and
<code>pigs/src/main</code>, since the new mechanism doesn&#8217;t require the <code>META-INF/services</code>
files.</p>
</div>
<div class="paragraph">
<p>Then, adjust the <code>module-info.java</code> files for each of those projects.</p>
</div>
<div class="listingblock">
<div class="title">fairy/src/main/java/module-info.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">module org.gradle.fairy.app {
    requires org.gradle.fairy.tale;
    uses org.gradle.fairy.tale.Tale;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bears/src/main/java/module-info.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">module org.gradle.fairy.tale.bears {
    requires org.gradle.actors;
    requires transitive org.gradle.fairy.tale;
    requires org.gradle.fairy.tale.formula;

    provides org.gradle.fairy.tale.Tale
        with org.gradle.fairy.tale.bears.GoldilocksAndTheThreeBears;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">pigs/src/main/java/module-info.java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">module org.gradle.fairy.tale.pigs {
    requires org.gradle.actors;
    requires transitive org.gradle.fairy.tale;
    requires org.gradle.fairy.tale.formula;

    provides org.gradle.fairy.tale.Tale
            with org.gradle.fairy.tale.pigs.ThreeLittlePigs;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>fairy</code> project&#8217;s <code>module-info.java</code> declares that it
<code>uses org.gradle.fairy.tale.Tale</code>, the <code>ServiceLoader</code> instance will
have access to any implementations provided at runtime by Java 9 modules
that declare <code>provides org.gradle.fairy.tale.Tale</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step_4_use_the_code_experimental_jigsaw_code_plugin_to_do_the_same_thing"><a class="anchor" href="#step_4_use_the_code_experimental_jigsaw_code_plugin_to_do_the_same_thing"></a><a class="link" href="#step_4_use_the_code_experimental_jigsaw_code_plugin_to_do_the_same_thing">Step 4 - Use the <code>experimental-jigsaw</code> plugin to do the same thing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>While Gradle does not yet support building Java 9 modules as a first-class
feature of the Java plugins, an experimental plugin is available to allow you to
experiment with Java 9 modules on your projects.</p>
</div>
<div class="paragraph">
<p>The <code>org.gradle.java.experimental-jigsaw</code> plugin is simply a convenient
mechanism for applying all of the changes in steps 1 through 3 of this guide
in one step. It <strong>may</strong> work for your project, but you should definitely
consider it experimental and not fit for production builds.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how to use the plugin:</p>
</div>
<div class="listingblock">
<div class="title">actors/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">plugins {
    id 'java-library'
    id 'org.gradle.java.experimental-jigsaw' version '0.1.1'  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just use <a href="https://plugins.gradle.org/plugin/org.gradle.java.experimental-jigsaw">the plugin</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>and:</p>
</div>
<div class="listingblock">
<div class="title">actors/build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">javaModule.name = 'org.gradle.actors'  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Change the line that specifies the module name to use the new <code>javaModule.name</code> settings.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a><a class="link" href="#summary">Summary</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point, your application is taking advantage of most of the
features of the Java 9 module system. This guide has shown you how to modify
the tasks added by the regular <code>java-library</code> and <code>application</code> plugins to get
them work on with Java 9 modules. In the future, the Gradle team will be adding
first-class support for the module system, but you can begin experimenting
today!</p>
</div>
</div>
</div>
<div class="sect1 contribute">
<h2 id="help_improve_this_guide"><a class="anchor" href="#help_improve_this_guide"></a><a class="link" href="#help_improve_this_guide">Help improve this guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Have feedback or a question? Found a typo? Like all Gradle guides, help is just a GitHub issue away. Please add an issue or pull request to <a href="https://github.com/gradle-guides/building-java-9-modules/">gradle-guides/building-java-9-modules</a> and we&#8217;ll get back to you.</p>
</div>
</div>
</div>
</div>
    </div>
    <!-- end div class="chapter" -->
    <aside class="secondary-navigation"></aside>
</main>

<footer class="site-layout__footer site-footer" itemscope="itemscope" itemtype="https://schema.org/WPFooter">
    <nav class="site-footer__navigation" itemtype="https://schema.org/SiteNavigationElement">
        <section class="site-footer__links">
            <div class="site-footer__link-group">
                <header><strong>Docs</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="/userguide/userguide.html" itemprop="url">User Manual</a></li>
                    <li itemprop="name"><a href="/dsl/" itemprop="url">DSL Reference</a></li>
                    <li itemprop="name"><a href="/release-notes.html" itemprop="url">Release Notes</a></li>
                    <li itemprop="name"><a href="/javadoc/" itemprop="url">Javadoc</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>News</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://blog.gradle.org/" itemprop="url">Blog</a></li>
                    <li itemprop="name"><a href="https://newsletter.gradle.com/" itemprop="url">Newsletter</a></li>
                    <li itemprop="name"><a href="https://twitter.com/gradle" itemprop="url">Twitter</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Products</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://gradle.com/build-scans" itemprop="url">Build Scans</a></li>
                    <li itemprop="name"><a href="https://gradle.com/build-cache" itemprop="url">Build Cache</a></li>
                    <li itemprop="name"><a href="https://gradle.com/enterprise/resources" itemprop="url">Enterprise Docs</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Get Help</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://discuss.gradle.org/c/help-discuss" itemprop="url">Forums</a></li>
                    <li itemprop="name"><a href="https://github.com/gradle/" itemprop="url">GitHub</a></li>
                    <li itemprop="name"><a href="https://gradle.org/training/" itemprop="url">Training</a></li>
                    <li itemprop="name"><a href="https://gradle.org/services/" itemprop="url">Services</a></li>
                </ul>
            </div>
        </section>
        <section class="site-footer__subscribe-newsletter">
            <p>Subscribe for important Gradle updates and news</p>
            <form id="newsletter-form" class="newsletter-form" action="https://go.pardot.com/l/68052/2017-12-01/b8dh7j" method="post">
                <input id="email" class="email" name="email" type="email" placeholder="name@email.com" pattern="[^@\s]+@[^@\s]+\.[^@\s]+" maxlength="255" required=""/>
                <button id="submit" class="submit" type="submit">Subscribe</button>
            </form>
            <p class="disclaimer">By entering your email, you agree to our <a href="https://gradle.org/terms/">Terms</a> and <a href="https://gradle.org/privacy/">Privacy Policy</a>, including receipt of emails. You can unsubscribe at any time.</p>
        </section>
    </nav>
    <div class="site-footer-secondary">
        <div class="site-footer-secondary__contents">
            <div class="site-footer__copy"> <a href="https://gradle.com">Gradle Inc.</a> <time>2018</time> All rights reserved.</div>
            <div class="site-footer__logo"><a href="/"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" class="logo-icon"><g style="fill:none;opacity:0.7"><g fill="#11272E"><path d="M37.7 7.1C36.4 4.8 34 4 32.4 4 30.4 4 28.7 5.1 29 5.9 29.1 6 29.5 6.8 29.7 7.2 30 7.7 30.6 7.3 30.9 7.2 31.5 6.9 32.2 6.7 32.9 6.8 33.6 6.9 34.6 7.4 35.3 8.6 36.8 11.6 32.1 17.8 26.2 13.5 20.3 9.3 14.5 10.7 11.9 11.5 9.3 12.4 8.1 13.3 9.2 15.3 10.6 18 10.1 17.1 11.5 19.4 13.6 22.9 18.3 17.7 18.3 17.7 14.8 23 11.8 21.7 10.6 19.9 9.6 18.2 8.8 16.3 8.8 16.3 -0.1 19.5 2.3 33.6 2.3 33.6L6.7 33.6C7.9 28.4 11.9 28.6 12.6 33.6L15.9 33.6C18.9 23.5 26.4 33.6 26.4 33.6L30.8 33.6C29.6 26.7 33.3 24.5 35.6 20.5 37.9 16.4 40.1 11.5 37.7 7.1L37.7 7.1ZM26.3 20.5C24 19.7 24.9 17.3 24.9 17.3 24.9 17.3 26.9 18 29.6 18.9 29.5 19.6 28.1 21 26.3 20.5L26.3 20.5Z"/><path d="M28.4 18.7C28.5 19.3 28 19.9 27.3 20 26.6 20.1 26 19.6 26 18.9 25.9 18.3 26.4 17.7 27.1 17.6 27.7 17.6 28.3 18 28.4 18.7"/><path d="M37.7 7.1C36.4 4.8 34 4 32.4 4 30.4 4 28.7 5.1 29 5.9 29.1 6 29.5 6.8 29.7 7.2 30 7.7 30.6 7.3 30.9 7.2 31.5 6.9 32.2 6.7 32.9 6.8 33.6 6.9 34.6 7.4 35.3 8.6 36.8 11.6 32.1 17.8 26.2 13.5 20.3 9.3 14.5 10.7 11.9 11.5 9.3 12.4 8.1 13.3 9.2 15.3 10.6 18 10.1 17.1 11.5 19.4 13.6 22.9 18.3 17.7 18.3 17.7 14.8 23 11.8 21.7 10.6 19.9 9.6 18.2 8.8 16.3 8.8 16.3 -0.1 19.5 2.3 33.6 2.3 33.6L6.7 33.6C7.9 28.4 11.9 28.6 12.6 33.6L15.9 33.6C18.9 23.5 26.4 33.6 26.4 33.6L30.8 33.6C29.6 26.7 33.3 24.5 35.6 20.5 37.9 16.4 40.1 11.5 37.7 7.1L37.7 7.1ZM26.3 20.5C24 19.7 24.9 17.3 24.9 17.3 24.9 17.3 26.9 18 29.6 18.9 29.5 19.6 28.1 21 26.3 20.5L26.3 20.5Z"/><path d="M28.4 18.7C28.5 19.3 28 19.9 27.3 20 26.6 20.1 26 19.6 26 18.9 25.9 18.3 26.4 17.7 27.1 17.6 27.7 17.6 28.3 18 28.4 18.7"/></g></g></svg></a></div>
            <div class="site-footer-secondary__links">
                <a href="https://gradle.com/careers" >Careers</a> |
                <a href="https://gradle.org/privacy">Privacy</a> |
                <a href="https://gradle.org/terms">Terms of Service</a> |
                <a href="https://gradle.org/contact/">Contact</a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    // Polyfill Element.matches()
    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }
    // Polyfill Element.closest()
    if (!Element.prototype.closest) {
        Element.prototype.closest = function(s) {
            var el = this;
            if (!document.documentElement.contains(el)) return null;
            do {
                if (typeof el.matches === "function" && el.matches(s)) return el;
                el = el.parentElement || el.parentNode;
            } while (el !== null);
            return null;
        };
    }
    [].forEach.call(document.querySelectorAll(".docs-navigation a[href$='"+ window.location.pathname +"']"), function(link) {
        // Add "active" to all links same as current URL
        link.classList.add("active");

        // Expand all parent navigation
        var parentListEl = link.closest("li");
        while (parentListEl !== null) {
            var dropDownEl = parentListEl.querySelector(".nav-dropdown");
            if (dropDownEl !== null) {
                dropDownEl.classList.add("expanded");
            }
            parentListEl = parentListEl.parentNode.closest("li");
        }
    });

    // Expand/contract multi-level side navigation
    [].forEach.call(document.querySelectorAll(".docs-navigation .nav-dropdown"), function registerSideNavActions(collapsibleElement) {
        collapsibleElement.addEventListener("click", function toggleExpandedSideNav(evt) {
            evt.preventDefault();
            evt.target.classList.toggle("expanded");
            evt.target.setAttribute("aria-expanded", evt.target.classList.contains("expanded").toString());
            return false;
        }, false);
    });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>